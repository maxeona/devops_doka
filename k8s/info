Установка через kubeadm (вручную)

Условия перед установкой:
1) Преобразования имен (прописать hosts(?))
2) Отключить firewall
3) Отключить selinux(?)
4)Отключить swap 

Установка:
1)Ставим докер
2)Install пакетов для куба
3)Конфигурим мастер ноду
4)Подсоединяем воркера 

Вы установите эти пакеты на все свои машины:
    • kubeadm: команда для начальной загрузки кластера.
    • kubelet: компонент, который работает на всех машинах в вашем кластере и выполняет такие действия, как запуск модулей и контейнеров.
    • kubectl: утилита командной строки для связи с вашим кластером.


Команды запуска

kubeadm init  --pod-network-cidr=172.16.0.0/16 — задаем подсетку адресов для сущностей (подов) куба(выполняется на мастере) → при исполнении этой команды, начинают скачиваться команды

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config  → этот файл можно скинуть себе на локалку, и управлять кубом вне ноды мастера 

получаем токен для подключения к кластеру для воркеров

ШАГ2
Install Network Driver


Главное, что-бы не пересекались подсетки с физ.машинами


kubectl create namespace

Запуск Pod
Обычная последовательность при старте Pod:
1) подготовка api-запроса
     актуальные схемы на kube-apiserver 
1) подготовка и валидация runtime-объекта
2) идентификация и авторизация запроса (токен, сертификат)
цепочка авторизаторов (rbac, abac, node) 
3) обработка запроса admission controllers 
4) сохранение ресурса в etcd
5) основной цикл обработки ресурсов (попадает в определенный контроллер )
6) запуск планировщика
7) магия kubelet
8) магия runtime

Sometimes our pod’s will be don’t run on node, because k8s use taints and tolerations

Taints – позволяют вводить ограничения на размещения модулей на определенных нодах

kubectl taint nodes node1 key1=value1:NoSchedule
добавление ограничения к узлу, что-бы ни один планироващик не помышлял о размещении модуля на данной ноде, без определенного допуска-разрешения 

kubectl taint nodes node1 key1=value1:NoSchedule- (добавление черточки в конце снимает ораничение)
отмена Taint

Кодовая база планировщика 
https://gist.github.com/jvns/5d492d66130a2f47b47820fd6b52eab5
